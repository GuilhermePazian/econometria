0.05^2
sqrt(0.05)
1.96*0.22**0.05+.45*.5
1.96*0.22*0.05+.45*.5
1.96*0.22*0.5+.45*.5
1.96*0.22*0.5-.45*.5
-1.96*0.22*0.5-.45*.5
qnorm(.975)
-1.96*0.22*0.5-.45*.5
fit.model_p <- glm(dados$`Nº de infecções` ~ dados$`Hab. de nadar` + dados$Local + dados$`Faixa etária` + dados$`Hab. de nadar`:dados$`Faixa etária` + dados$`Hab. de nadar`:dados$Local + dados$Local:dados$`Faixa etária`, family=poisson(link="log"),data = dados)
#mudando o separador decimal para resultados "printados"
options(OutDec= ",")
#definindo opções padrões dos chunks
knitr::opts_chunk$set(fig.width=6, fig.height=3.5, fig.path='Figs/', fig.align='center', echo=FALSE, warning=FALSE, message=FALSE)
library(dplyr)
library(xtable)
dados <- read.table("recrutas.dat")
colnames(dados) <- c("Hab. de nadar", "Local", "Faixa etária", "Sexo", "Nº de infecções")
#table(is.na(dados))
# table(dados$`Hab. de nadar`, dados$`Nº de infecções`)
# table(dados$Local, dados$`Nº de infecções`)
# table(dados$`Faixa etária`, dados$`Nº de infecções`)
# table(dados$Sexo, dados$`Nº de infecções`)
# dados %>% group_by(`Hab. de nadar`) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
# dados %>% group_by(Local) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
# dados %>% group_by(`Faixa etária`) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
# dados %>% group_by(Sexo) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
#
# xtable(dados %>% group_by(`Hab. de nadar`) %>% summarise(Cont_num_infec = sum(`Nº de infecções`)))
# xtable(dados %>% group_by(Local) %>% summarise(Cont_num_infec = sum(`Nº de infecções`)))
# xtable(dados %>% group_by(`Faixa etária`) %>% summarise(Cont_num_infec = sum(`Nº de infecções`)))
# xtable(dados %>% group_by(Sexo) %>% summarise(Cont_num_infec = sum(`Nº de infecções`)))
#dados %>% group_by(`Hab. de nadar`, Local) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
#dados %>% group_by(`Hab. de nadar`, Sexo) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
#número médio de infecções para indivíduos que tiveram pelo menos uma infecção, agrupdos pelo Local, Habito de nadar e sexo
#dados %>% group_by(Local, `Faixa etária`) %>% summarise(Num_medio_infec = mean(`Nº de infecções`))
#dados %>% group_by(`Hab. de nadar`, `Faixa etária`) %>% summarise(Num_medio_infec = mean(`Nº de infecções`))
#dados %>% group_by(Sexo, `Faixa etária`) %>% summarise(Num_medio_infec = mean(`Nº de infecções`))
fig1 <- "Gráfico de perfil que representa o número de infecções de ouvido para cada sexo. Nota-se que ao mudar de faixa etária há diminuição do número de infecções para ambos os sexos. Observa-se que a redução é maior ao mudar da faixa etária de 15-19 para 20-24 para o sexo masculino. Pelo gráfico, pode-se pensar que existe interação entre as covariáveis faixa etária e sexo."
fig2 <- "Gráfico de perfil que representa o número de infecções para os grupos que têm hábitos (frequente e ocasional) de nadar diferentes. Para estes diferentes grupos de hábitos de nadar, nota-se que o número de infecções diminui. No entanto, para aqueles cujo hábito é ocasional, a quantidade de infecções é superior para os diferentes níveis de faixa etária. Cogita-se que possa existir interação entre o hábito de nadar e a faixa etária."
fig3 <- "Gráfico de perfil que representa o número de infecções para os indivíduos que costumam nadar na praia ou na piscina. Com exceção da última faixa etária (25-29), o número de infecções para indivíduos que costumam nadar em piscinas é maior para as diferentes faixas etárias, de 15-19 e 20-24. Observa-se que para os diferentes lugares onde se costuma nadar, nas faixas etárias 15-19 e 20-14, as retas possuem um pequeno desnível que as tornam não paralelas. No entanto, para a última faixa etária, nota-se que o comportamento é diferente para os diferentes locais onde se costuma nadar. Assim, é possível pensar em interação entre a faixa etária e o local onde se costuma nadar."
fig4 <- "Gráfico de perfil que representa o número de infecções para os indivíduos que tem um determinado hábito de nadar, para os diferentes sexos. Observa-se que as retas não são paralelas, com isso pode-se pensar que existe interação entre o sexo e o hábito de nadar."
fig5 <- "Gráfico de perfil que representa o número de infecções para os indivíduos que tem determinado hábito de nadar e o local que costumam nadar. O comportamento é muito similar em relação à figura 4 e cogita-se na possível interação entre local onde costuma nadar e hábito de nadar."
fig6 <- "Gráfico de perfil que representa o número de infecções para os sexos, para indivíduos que tem costume de nadar em diferentes lugares. Nota-se que é plusível a interação entre sexo e o lugar onde costuma nadar."
# teste <- dados %>% group_by(Sexo, `Faixa etária`) %>% summarise(Num_medio_infec = mean(`Nº de infecções`))
# par(mfrow=c(1,1))
# plot(teste[[3]][teste[[1]] == "Female"],pch=19,lty=1,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2,axes=F,ylim=c(0,2),xlab="faixa etária",ylab="nº médio de infecções")
# lines(teste[[3]][teste[[1]] == "Male"],pch=17,lty=2,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
# #lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
# #lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
# axis(2)
# axis(1,c(1,2,3),labels=c("15-19","20-24","25-29"))
# legend(1,0.5,c("Feminino","Masculino"),lty=c(1,2),pch=c(19,17),bty="n",cex=1)
SFE <- dados %>% group_by(Sexo, `Faixa etária`) %>% summarise(contagem_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(SFE[[3]][SFE[[1]] == "Female"],pch=19,lty=1,type="b",cex=.7,cex.axis=.7,cex.lab=.7,axes=F,ylim=c(0,200),xlab="faixa etária",ylab="nº de infecções")
lines(SFE[[3]][SFE[[1]] == "Male"],pch=17,lty=2,type="b",cex=.7,cex.axis=.7,cex.lab=.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2,3),labels=c("15-19","20-24","25-29"), cex.axis = 0.7)
legend(1,40,c("Feminino","Masculino"),lty=c(1,2),pch=c(19,17),bty="n",cex=.7)
HNFE <- dados %>% group_by(`Hab. de nadar`, `Faixa etária`) %>% summarise(contagem_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(HNFE[[3]][HNFE[[1]] == "Freq"],pch=19,lty=1,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7,axes=F,ylim=c(0,200),xlab="faixa etária",ylab="nº de infecções")
lines(HNFE[[3]][HNFE[[1]] == "Occas"],pch=17,lty=2,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2,3),labels=c("15-19","20-24","25-29"), cex.axis = 0.7)
legend(1,40,c("Frequente","Ocasional"),lty=c(1,2),pch=c(19,17),bty="n",cex=.7)
LFE <- dados %>% group_by(Local, `Faixa etária`) %>% summarise(contagem_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(LFE[[3]][LFE[[1]] == "Beach"],pch=19,lty=1,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7,axes=F,ylim=c(0,200),xlab="faixa etária",ylab="nº de infecções")
lines(LFE[[3]][LFE[[1]] == "NonBeach"],pch=17,lty=2,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2,3),labels=c("15-19","20-24","25-29"), cex.axis = 0.7)
legend(1,40,c("Praia","Piscina"),lty=c(1,2),pch=c(19,17),bty="n",cex=0.7)
HNS <- dados %>% group_by(`Hab. de nadar`, Sexo) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(HNS[[3]][HNS[[1]] == "Freq"],pch=19,lty=1,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7,axes=F,ylim=c(0,200),xlab="Sexo",ylab="nº de infecções")
lines(HNS[[3]][HNS[[1]] == "Occas"],pch=17,lty=2,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2),labels=c("Feminino","Masculino"), cex.axis = 0.7)
legend(1,40,c("Frequente","Ocasional"),lty=c(1,2),pch=c(19,17),bty="n",cex=0.7)
HNL <- dados %>% group_by(`Hab. de nadar`, Local) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(HNL[[3]][HNL[[1]] == "Freq"],pch=19,lty=1,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7,axes=F,ylim=c(0,200),xlab="Local onde costuma nadar",ylab="nº de infecções")
lines(HNL[[3]][HNL[[1]] == "Occas"],pch=17,lty=2,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2),labels=c("Praia","Piscina"), cex.axis = 0.7)
legend(1,40,c("Frequente","Ocasional"),lty=c(1,2),pch=c(19,17),bty="n",cex=0.7)
LS <- dados %>% group_by(Local, Sexo) %>% summarise(Cont_num_infec = sum(`Nº de infecções`))
par(mfrow=c(1,1))
plot(LS[[3]][LS[[1]] == "Beach"],pch=19,lty=1,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7,axes=F,ylim=c(0,200),xlab="Sexo",ylab="nº de infecções")
lines(LS[[3]][LS[[1]] == "NonBeach"],pch=17,lty=2,type="b",cex=0.7,cex.axis=0.7,cex.lab=0.7)
#lines(taxas[dadosc$consumo=="10-30"],pch=15,lty=3,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
#lines(taxas[dadosc$consumo=="+30"],pch=18,lty=4,type="b",cex=1.2,cex.axis=1.2,cex.lab=1.2)
axis(2, cex.axis = 0.7)
axis(1,c(1,2),labels=c("Feminino","Masculino"), cex.axis = 0.7)
legend(1,40,c("Praia","Piscina"),lty=c(1,2),pch=c(19,17),bty="n",cex=0.7)
source("codigos/diag_pois.r")
source("codigos/envel_pois.r")
source("codigos/TestesMRDD.r")
fit_completo <- glm(dados$`Nº de infecções`~ dados$`Hab. de nadar` * dados$`Local` * dados$`Faixa etária` *dados$`Sexo`,family=poisson(link="log"),data = dados)
library(xtable)
gerador_tbl_coef <- function(fit.model){
options(encoding="utf-8")
tabela <- summary(fit.model)$coefficients
tabela[,4] <- ifelse(tabela[,4] < 0.0001,"<0,0001",tabela[,4])
colnames(tabela) <- c("Estimativa","Erro Padrão","Estatística Z", "P-valor")
options(OutDec= ",")
return(xtable(tabela,digits = 4))
}
fit.model_p <- glm(dados$`Nº de infecções` ~ dados$`Hab. de nadar` + dados$Local + dados$`Faixa etária` + dados$`Hab. de nadar`:dados$`Faixa etária` + dados$`Hab. de nadar`:dados$Local + dados$Local:dados$`Faixa etária`, family=poisson(link="log"),data = dados)
#gerador_tbl_coef(fit.model_p)
fig7 <- "Gráficos para verificar a adequabilidade do ajuste para o modelo completo (note que R.C.D. é o acrônimo para Resíduo Componente do Desvio). Pelo Gráfico 1 nota-se que muitos resíduos estão fora dos limites [-2, 2], ou seja, valores dos resíduos muito extremos. Pelo Gráfico 2, também percebe-se que muitos dos valores ajustados estão fora de [-2,2], característica não procurada para um ajuste razoável. Para o Gráfico 3, observa-se possivelmente problemas com a função de ligação e/ou com o preditor linear. Neste último gráfico, o desejável é que os pontos fiquem mais próximos da reta de referência, característica não presente neste ajuste."
fig8 <- "Este gráfico compara os quantís do RCD para o modelo completo (ver Paula, 2013). Note que muitos dos resíduos estão fora da banda de confiança e muito distantes da linha de referência (tracejada). Com isso, pode-se comcluir que o ajuste não é razoável para os dados em questão."
fig9 <- "Gráficos para verificar a adequabilidade do ajuste para o modelo reduzido. Pelo Gráfico 1 observa-se que existem muitos pontos que estão fora dos limites -2 e 2, isto é, observações discrepantes. Pelo Gráfico 2, nota-se também muitos pontos fora do intervalo -2 e 2, além de que existem muitos valores ajustados (média) concentrados entre [0,5;1,5] e menos concentrados entre aproximadamente [1,5;2,75]. Isto se deve possivelmente as características dos próprios dados, ou seja, pode-se ter maior concentração de indivíduos cujas características do valor do preditor linear é semelhante e consequentemente, provocar a concentração mencionada. Pelo Gráfico 3, diagnosticou-se que, possivelmente, falta alguma covariável para compor o preditor linear ou há algum problema com a função de ligação."
fig10 <- "Este gráfico compara os quantís do RCD para o modelo reduzido (ver Paula, 2013). Quanto mais pontos estiverem dentro da banda de confiança (linha cheia) e perto da reta pontilhada (linha de referência), mais indicativos temos de um bom ajuste. Observa-se claramente que o ajuste, portanto, não é razoável."
diagPoisson(fit_completo)
envelPoisson(fit_completo, "log")
diagPoisson(fit.model_p)
envelPoisson(fit.model_p, "log")
media <- mean(dados$`Nº de infecções`)
variancia <- var(dados$`Nº de infecções`)
#pacotes caio Usados no exemplo "Número de acidentes" ( que tem a binomial negativa)
library(xtable)
library(plotrix)
library(plyr)
library(lattice)
#library(HistogramTools)
library(MASS)
fit.model_BN <- glm.nb(dados$`Nº de infecções`~ dados$`Hab. de nadar` * dados$`Local` * dados$`Faixa etária` * dados$`Sexo`,link="log",data = dados)
source("codigos/envel_nbin.r")
source("codigos/diag_nbin.r")
desvio <- fit.model_BN$deviance
gl_desvio <- fit.model_BN$df.residual
p_valor_desvio <- 1-pchisq(desvio,gl_desvio)
fig11 <- "Gráficos para verificar a adequabilidade do ajuste para o modelo completo. Nota-se pelos Gráficos 1 e 2 que são poucos os valores dos resíduos que estão fora do intervalo [-2,2], comportamento diferente em relação ao modelo de Poisson completo. No entanto, quando se observa o Gráfico 3, pode-se notar que o comportamento é muito similar quando se compara com o modelo de Poisson completo. Possivelmente características relacionadas com as covariáveis do preditor linear e/ou a função de ligação influenia nessa tal característica."
fig12 <- "Este gráfico compara os quantis do RCD para o modelo completo. Nota-se que muitos dos resíduos estão dentro da banda de confiança e próximos da linha de referência. Isto evidencia um bom ajuste. Observa-se, além disso, a grande diferença quando comparado com o modelo de Poisson completo."
diagnbin(fit.model_BN)
ligacaonbin <-"log"
envelnbin(fit.model_BN)
